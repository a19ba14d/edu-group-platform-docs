# 附件1：《需求规格说明书》（数字教育管理系统）

| 项目 | 内容 |
|---|---|
| 项目名称 | 集团化数字教育管理系统（多校区/多学校统一管理平台） |
| 文档名称 | 需求规格说明书 |
| 版本号 | V1.0 |
| 编制日期 | 2026-01-02 |
| 适用合同 | 《软件开发外包服务合同（技术开发/委托开发）》 |

## 1. 版本变更记录

| 版本 | 日期 | 变更说明 | 提出方 | 确认方 |
|---|---|---|---|---|
| V1.0 | 2026-01-02 | 初版：基于合同模板与技术规范整理需求范围、技术要求与交付物清单 | 乙方 | 甲/乙双方 |

## 2. 项目背景与范围定义

### 2.1 项目背景
本项目为**集团化教育管理平台**，面向同一集团下的多所学校（小学/初中/高中）提供统一的组织、人员、教务与运营管理能力。

### 2.2 范围边界（用于验收与变更）
1. 本系统为**多租户（Multi-tenant）**平台，业务数据通过 `school_id` 进行学校级隔离；集团人员可按授权在“全集团汇总/指定学校视角”查看。
2. 本文档列明的功能点为范围基线，任何新增/删减/调整均应按合同第七条“变更管理”执行并形成书面变更单。

## 3. 功能模块与开发顺序（按需求优先级）

> 注：下列功能点完整来源于 `附件/需求.txt`，叶子节点（带【Rxx-xxx】编号）为可验收的功能点；模块/子模块标题用于归类。

### 模块01：用户数据
- 用户注册
  - 内部用户（管理账号）
    - 用户列表【R01-001】
    - 新增用户【R01-002】
    - 编辑用户【R01-003】
    - 删除用户（假删除）【R01-004】
  - 外部用户
    - 注册（外部注册）
      - 审核用户
        - 可编辑用户【R01-005】
      - 退回、删除【R01-006】
    - 基础预注册H5
      - 关键信息录入
        - 自行小程序匹配【R01-007】
    - 补充功能
      - 批量导入
        - 关联教师信息系统【R01-008】
        - 关联学生信息系统【R01-009】
  - 补充功能
    - 授权关联
      - 微信关联
        - OpenId 关联小程序、公众号【R01-010】
      - 一卡通关联
        - 一卡通数据系统同步【R01-011】
        - 临时二维码扫码【R01-012】
    - 小程序相关 （教师学生信息功能完成后）
      - 关联个人信息
        - 学生家长关联【R01-013】
        - 教师关联【R01-014】
        - 修改信息
          - 手机号【R01-015】
          - 地址等【R01-016】
- 用户登录
  - 管理员、教职工
    - WEB 端
      - 用户名密码【R01-017】
      - 手机验证码【R01-018】
      - 第三方关联
        - 微信【R01-019】
        - 钉钉等...【R01-020】
    - 小程序端
      - 公众号绑定（首次）
        - 手机验证码【R01-021】
        - 账号密码【R01-022】
      - OpenId关联登录【R01-023】
  - 家长及学生
    - 小程序端
      - 公众号绑定（首次）
        - 手机验证码登录【R01-024】
      - OpenId 关联登录【R01-025】
- 补充功能点
  - 数据存储方案
    - 前端服务器方案【R01-026】
    - 数据存储方案【R01-027】
    - NFS 本地调用【R01-028】
    - oss 云存储【R01-029】

### 模块02：通知系统
- 短信下发
  - 短信通道管理
    - 列表【R02-001】
    - 增加【R02-002】
    - 编辑、删除【R02-003】
  - 短信列表【R02-004】
  - 短信模板
    - 模板列表【R02-005】
    - 增加
      - 对应子系统
        - 注册系统【R02-006】
        - 登录验证【R02-007】
    - 编辑、删除【R02-008】
  - 短信发送
    - 列表及状态【R02-009】
    - 新增发送
      - 审核体系、模板信息与自由信息审核规则【R02-010】
      - 发送延时机制【R02-011】
    - 撤回【R02-012】
- 微信推送
  - 模板信息
    - 对应 openid
      - 标准服务号通知【R02-013】
  - 信息列表
    - 推送历史信息
      - 记录列表、范围【R02-014】
    - 相关信息推送人员记录【R02-015】
  - 通道状态监控【R02-016】

### 模块03：权限系统
- 管理权限
  - 权限分级
    - 系统级用户【R03-001】
    - 用户级权限【R03-002】
    - 操作级权限【R03-003】
  - RBAC
    - 角色管理
      - 列表【R03-004】
      - 增、删、改【R03-005】
    - 子系统管理
      - 列表【R03-006】
      - 增、删、改【R03-007】
    - 菜单管理
      - 列表【R03-008】
      - 自动菜单【R03-009】
      - 增、删【R03-010】
      - 牟接操作级权限【R03-011】
    - 操作管理
      - 规则【R03-012】
      - 页面匹配【R03-013】
- 岗位管理
  - 教职工岗位（多对多）
    - 关联教职工系统【R03-014】
    - 教学岗【R03-015】
    - 行政岗【R03-016】
    - 勤杂岗【R03-017】
    - 临时岗【R03-018】
  - 学生（独立子系统）
    - 微信小程序【R03-019】

### 模块04：校园体系
- 校园管理
  - 列表【R04-001】
  - 增、删、改、查【R04-002】
  - 权限系统
    - 对应管理层级【R04-003】
    - 对应教职工【R04-004】
- 校区（学部）管理
  - 列表【R04-005】
  - 增、删、改、查【R04-006】
  - 权限系统
    - 对应校园【R04-007】
- 教学楼管理
  - 列表
    - 隶属于校园【R04-008】
  - 增、删、改、查【R04-009】
- 教室管理
  - 列表
    - 隶属于校园、教学楼【R04-010】
  - 增、删、改、查【R04-011】
- 班级管理
  - 列表
    - 关联学校【R04-012】
    - 关联教室【R04-013】
  - 增、删、改、查【R04-014】
  - 学年管理【R04-015】
  - 行政班管理
    - 行政班、年级转换【R04-016】
    - 班主任指定【R04-017】
  - 学期管理【R04-018】
- 科目管理
  - 列表【R04-019】
  - 增、删、改、查【R04-020】

### 模块05：人员相关 15%
- 教职工管理
  - 人事管理系统
    - 入职登记
      - 手动登记信息【R05-001】
      - 人员自登记信息
        - 邀请推送【R05-002】
        - 信息填写【R05-003】
        - 资料上传【R05-004】
        - 信息审核【R05-005】
        - 推回修正【R05-006】
      - 对接一卡通系统
        - 入职流程状态【R05-007】
    - 离职登记【R05-008】
    - 退休登记【R05-009】
  - 考勤
    - 考勤规则
      - 规则列表【R05-010】
      - 新增【R05-011】
      - 修改、删除规则【R05-012】
    - 考勤渠道绑定
      - 刷卡【R05-013】
      - 人脸【R05-014】
    - 请假
      - 请假申请【R05-015】
      - 审批/驳回【R05-016】
      - 销假【R05-017】
      - 历史记录【R05-018】
    - 补考勤
      - 补考勤申请【R05-019】
      - 审批/驳回【R05-020】
  - 补充功能
    - 人事管理系统
      - 原有人事系统对接
        - 数据互通/单向同步【R05-021】
      - 人资列表
        - Excel 批量导入【R05-022】
- 学生管理
  - 学生信息
    - 学生相关
      - 学生信息列表
        - 家长填写【R05-023】
        - 班主任修改【R05-024】
        - 教务管理修改【R05-025】
      - 增加【R05-026】
      - 修改、删除【R05-027】
      - 学费标准【R05-028】
    - 学籍
      - 对应学生列表【R05-029】
      - 增加
        - 家长及班主任填写
          - 信息上传
            - 审核【R05-030】
      - 修改删除【R05-031】
    - 学位
      - 对应学生列表【R05-032】
      - 增、删
        - 班主任及教务管理
          - 审核【R05-033】
    - 差异
      - 学籍在校列表【R05-034】
      - 学位在校列表【R05-035】
      - 差异在校列表【R05-036】
      - 标准在校列表【R05-037】
    - 安全
      - 定位（配合硬件）【R05-038】
      - 摄像头追踪【R05-039】
    - 成绩
      - 考试类别
        - 列表【R05-040】
        - 创建【R05-041】
        - 管理修改【R05-042】
      - 成绩录入
        - 手工录入
          - 单科录入
            - 手工【R05-043】
            - 模板导入【R05-044】
          - 单人录入
            - 手工【R05-045】
            - 模板导入【R05-046】
          - 总表导入【R05-047】
        - 自动录入【R05-048】
    - 补充功能
      - 考勤
        - 一卡通关联【R05-049】
        - 人脸关联【R05-050】
      - 健康
        - 体温检测
          - 入校【R05-051】
          - 出校【R05-052】
          - 报警信息推送
            - 推送班主任【R05-053】
            - 推送家长【R05-054】
  - 家长相关
    - 信息推送
      - 成绩信息【R05-055】
      - 公告信息【R05-056】
      - 收费信息【R05-057】
    - 信息填写
      - 补充学生信息【R05-058】
      - 填写家庭相关信息
        - 家长信息【R05-059】
        - 地址信息【R05-060】
        - 联系信息【R05-061】
    - 相关人授权
      - 一对多家长管理【R05-062】
- 补充功能
  - 一卡通（硬件配合）
    - 列表
      - 统计功能【R05-063】
  - 访问管理
    - 门禁(配合硬件改造)
      - 人脸识别【R05-064】
      - 日志记录
        - 日志列表【R05-065】
    - 软件
      - 原有子门禁系统对接【R05-066】

### 模块06：排课系统 15%
- 课程管理
  - 列表
    - 对应学校【R06-001】
    - 对应年级【R06-002】
    - 班级特殊增加【R06-003】
- 教学计划
  - 对应年级【R06-004】
  - 对应学科【R06-005】
- 教学班设置
  - 分年级班设置【R06-006】
  - 上课单双周设置【R06-007】
  - 课时拆分【R06-008】
- 教师安排
  - 任课学科【R06-009】
  - 班级学科【R06-010】
  - 教师视角【R06-011】
- 排课条件
  - 班级作息
    - 每周天数【R06-012】
    - 早晚自习数【R06-013】
    - 课时长【R06-014】
    - 上下午课数时间【R06-015】
    - 大课间【R06-016】
    - 课程调换【R06-017】
  - 规则设置
    - 班级冲突【R06-018】
    - 教师冲突【R06-019】
    - 教室冲突【R06-020】
    - 场地要求【R06-021】
    - 教学班不排课时间【R06-022】
    - 教师不排课时间【R06-023】
    - 教师互斥【R06-024】
    - 教师限制
      - 上下午限制【R06-025】
      - 周内课时限制【R06-026】
    - 连堂限制【R06-027】
- 预排课
  - 按条件预排【R06-028】
- 整表排课工具【R06-029】
- 展示体系
  - 教务【R06-030】
  - 教师【R06-031】
  - 班级【R06-032】
- 课程调换【R06-033】
- 饱和度评估【R06-034】

### 模块07：在线学习 15%
- 对应校园和排课体系【R07-001】
- 课程管理
  - 课程列表
    - 查看【R07-002】
    - 修改、删除、屏蔽【R07-003】
  - 增加/修改课程
    - 课程结构
      - 对应课本结构
        - 填加【R07-004】
        - 修改、删除【R07-005】
      - 对应班级讲解结构
        - 对应教案结构【R07-006】
        - 对应教师讲解结构【R07-007】
      - 课程列表
        - 单元填充【R07-008】
        - 章节填充【R07-009】
        - 版本管理【R07-010】
    - 知识点分解
      - 知识点对应课程结构【R07-011】
      - 知识点公共名称对应
        - 跨校区对应【R07-012】
        - 不同教师对应【R07-013】
    - 知识点讲解
      - 文字讲解【R07-014】
      - 视频讲解【R07-015】
      - 知识点采集
        - 知识点填充
          - 任课教师填充
            - 一对多【R07-016】
          - 学科教师填充
            - 一对多【R07-017】
          - 外来采集填充【R07-018】
        - 知识点修改
          - 修改本要上传内容【R07-019】
        - 审核
          - 新增、修改须审核【R07-020】
  - 课程使用权限
    - 权限规则设定【R07-021】
    - 同步教学跟踪
      - 按教案对应内容【R07-022】
- 课程使用
  - 小程序端【R07-023】
- 课程跟踪
  - 我的课程【R07-024】
  - 学习历史【R07-025】
  - 学习评估【R07-026】
  - 笔记系统【R07-027】
- 考试系统
  - 题库数据结构
    - 题目
      - 类型
        - 客观【R07-028】
        - 主观【R07-029】
    - 附件
      - 图片【R07-030】
      - 公式【R07-031】
    - 答案
      - 选择题答案及标准答案【R07-032】
      - 主观题参考答案【R07-033】
  - 知识点题库
    - 题库录入
      - 外来题库导入【R07-034】
      - 内部题库增加
        - 题库编辑系统【R07-035】
    - 题库关联
      - 学科关联【R07-036】
      - 知识点关联
        - 一对多知识点【R07-037】
        - 多知识点前置判断【R07-038】

### 模块08：财物相关  15%
- 财务管理
  - 第三方系统对接（用友等）
    - 用友 U8 公共接口【R08-001】
  - 数据接口对接【R08-002】
  - 报表及统计数据同步
    - 数据展示【R08-003】
- 资产管理
  - 资产列表
    - 新增【R08-004】
    - 修改、删除【R08-005】
    - 折旧【R08-006】
    - 统计报表
      - 导出报表【R08-007】
  - 标签
    - 标签规则【R08-008】
    - 生成标签【R08-009】
    - 打印标签【R08-010】
  - 资产盘点
    - 手工盘点【R08-011】
    - 扫码盘点【R08-012】
  - 资产使用流程
    - 申请【R08-013】
    - 审核【R08-014】
    - 归还【R08-015】
    - 人工管理【R08-016】
  - 报修
    - 申请【R08-017】
    - 处理、回执【R08-018】
  - 会议室管理
    - 会议室列表
      - 状态显示【R08-019】
    - 会议室申请
      - 审核
        - 通知【R08-020】
    - 会议室申请撤消【R08-021】
- 无纸化办公
  - 流程管理
    - 对应各子系统申请流程【R08-022】
  - 合同管理
    - 合同列表
      - 对应教职工【R08-023】
      - 合同期限管理【R08-024】
    - 合同录入
      - 手工签订
        - 上传备案【R08-025】

### 模块09：补齐功能点 15%
- 数据中心
  - 基础数据管理
    - 用户数据
      - 用户登录
        - 密码找回
          - 手机验证码找回【R09-001】
          - 身份证相关信息验证【R09-002】
          - ...【R09-003】
      - 单点 SSO
        - 财务子系统【R09-004】
        - 原有子系统【R09-005】
    - 通知系统
      - 站内通知
        - 系统通知消息
          - 列表【R09-006】
          - 下发【R09-007】
          - 通知【R09-008】
        - 操作通知【R09-009】
        - 流程通知
          - 跳转子系统相关流程【R09-010】
    - 日志数据
      - 登录数据
        - 登录日志【R09-011】
        - 异常规则【R09-012】
      - 操作审计
        - 接操作日志子系统【R09-013】
        - 操作列表【R09-014】
      - 异常操作信息
        - 异常列表【R09-015】
        - 异常规则
          - 列表【R09-016】
          - 增加【R09-017】
          - 编辑、删除【R09-018】
      - 系统故障信息
        - 故障列表【R09-019】
    - 服务注册体系
      - 微服务注册
        - 自动注册
          - 列表【R09-020】
        - 手动注册
          - 新增【R09-021】
        - 服务删除【R09-022】
      - 微服务监控
        - 服务状态列表【R09-023】
      - 微服务报警
        - 报警信息列表【R09-024】
        - 报警规则【R09-025】
  - 数据存储方案
    - NFS 本地调用
      - 硬件解决方案，待协调【R09-026】
    - oss 云存储
      - 成本计算、待测算【R09-027】
  - 数据展示
    - 数据大屏
      - 中台展示页面【R09-028】
      - 数据大屏页面【R09-029】
      - 专题页面【R09-030】
    - 管理图表
      - 教师相关统计【R09-031】
      - 学生相关统计【R09-032】
      - 资产相关统计【R09-033】
      - 财务相关统计【R09-034】
- 校园体系
  - 班级列表
    - 结业管理
      - 自动结业【R09-035】
      - 手动结业【R09-036】
  - 教室绑定
    - 固定教室绑定
      - 列表【R09-037】
      - 增加【R09-038】
      - 修改、删除【R09-039】
    - 临时教室绑定
      - 列表【R09-040】
      - 时间线排重【R09-041】
  - 关联基础数据权限【R09-042】
- 排课系统
  - 开课
    - 学科组【R09-043】
    - 学年组【R09-044】
    - 其他【R09-045】
- 成绩评价系统
  - 历年成绩
    - 按学生查询【R09-046】
    - 按班级查询【R09-047】
    - 按年级查询【R09-048】
    - 会考
      - 导入【R09-049】
      - 数据对接【R09-050】
  - 打印
    - 按查询结果打印【R09-051】
  - 综合素质测评
    - 评测规则
      - 规则列表【R09-052】
      - 增加【R09-053】
      - 修改、删除【R09-054】
- 备课系统
  - 知识点标记【R09-055】
  - 历年考题【R09-056】


## 4. 业务角色与权限边界（概要）

| 角色/主体 | 典型权限范围 |
|---|---|
| 集团管理员（Group） | 全集团汇总视角；可按授权通过 `X-View-Scope` 切换学校视角；需强制审计 |
| 学校管理员（School） | 仅本校数据；管理本校用户、校园结构、人员、教务等 |
| 校区/学部/部门管理员 | 仅授权组织子树范围；对人员与班级等资源进行管理 |
| 教职工 | 业务办理与数据录入（按岗位/权限） |
| 学生/家长（小程序） | 与本人相关的数据查询、信息提交、通知接收（按授权） |

## 5. 数据隔离与多租户要求（强制）

### 5.1 主键与租户字段
- 数据库：PostgreSQL 15。
- 业务表主键：统一使用 `UUID`（数据库类型必须为 `UUID`，禁止使用 `VARCHAR(36)`）。
- **强制字段**：所有业务表必须包含 `school_id (UUID)`，并通过 Ent Mixin 注入；`school_id` 写入后**不可修改（Immutable）**。

### 5.2 组织架构与层级一致性
- 组织树：集团 → 学校 → 校区 → 学部/部门 → 班级等；数据模型采用“邻接表 + 路径枚举（path）”。
- `parent_id` 与 `path` 必须建索引；`path` 必须通过 Ent Hook 自动维护；禁止形成循环引用。

### 5.3 集团/学校视角访问规则
- 系统支持：学校模式（School Mode）与集团模式（Group Mode）。
- 集团端 API 允许通过 Header 携带 `X-View-Scope`：
  - `all`：全集团汇总（仅集团管理员可用）
  - `{school_uuid}`：指定学校视角
- 后端必须校验：JWT 中 `org_id`、`org_type`、`role`；并基于 `path` 判断目标学校是否在授权子树内。
- 集团人员进入学校视角的“查看/修改”必须写入审计日志（含 operator_id、target_school_id、resource 等字段）。

## 6. 技术要求（与验收挂钩）

### 6.1 架构与框架
- 后端：Go 1.20+，基于 **go-zero** 的微服务架构（Monorepo）。
- ORM：**Ent (entgo.io)**。
- 缓存：Redis 7+。
- 消息流：Kafka。
- 任务队列：Asynq（延迟/定时/异步任务）。
- 分布式事务：DTM（跨服务一致性）。
- 链路追踪：Jaeger。
- 日志：ELK（配合 Go-stash），日志必须可按 `school_id`、`trace_id` 检索。

### 6.2 API 先行与代码生成约束
- 必须在 `manifests/api/` 定义 `.api` 文件，经评审后使用 `goctl` 生成。
- 生成代码中：`handler`、`types` 层禁止修改；业务逻辑在 `logic` 层实现。

### 6.3 数据库变更
- 禁止手工直接改库；所有结构变更必须通过 Ent Schema + 版本化 Migration（`data/migration/`）完成，提供 `up/down`。

## 7. 交付物清单与格式要求

| 交付物 | 形式/格式 | 最小要求 | 交付节点 |
|---|---|---|---|
| 源代码 | 私有 Git 仓库（Monorepo） | 分支策略、Conventional Commits、可复现构建 | 各里程碑 |
| 数据库迁移 | `data/migration/*.go` | up/down、版本化、可回滚 | 各里程碑 |
| 部署脚本 | `deploy/docker-compose/`、`deploy/k8s/` | 一键部署/回滚说明 | M2/M4 |
| API 文档 | `.api` 文件 + 生成文档（如 Swagger/OpenAPI） | 覆盖全部对外 API | 各里程碑 |
| 运维手册 | Markdown/PDF | 启停、备份恢复、告警、常见故障 | M4 |
| 用户手册 | Markdown/PDF | 角色权限、关键流程截图/说明 | M4 |
| 培训材料 | PPT/PDF + 录屏（可选） | 管理端+小程序端使用培训 | M4 |
| 测试产物 | 报告/截图/覆盖率 | 核心逻辑覆盖率≥80% | 各里程碑 |

## 8. 前置条件与第三方依赖（风险控制）

1. 甲方需提供：服务器/域名/证书/白名单/账号权限（开发/测试/验收/生产环境）。
2. 涉及第三方：短信通道、微信（服务号/小程序）、钉钉、OSS/NFS、以及一卡通/硬件定位/摄像头等系统对接账号与文档由甲方提供并承担费用。
3. 第三方接口变更、限流、授权到期等不可控因素造成的改造，按合同“第三方资源与变更管理”处理。

## 9. 确认与签署

甲方确认代表（签字/盖章）：______________   日期：____年__月__日  
乙方确认代表（签字/盖章）：______________   日期：____年__月__日  
