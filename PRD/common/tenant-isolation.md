# 多租户隔离（school_id）规范

> 强制来源：`附件/01-三橙智星开发团队技术协议与开发规范.md` + `附件/附件3-验收标准.md`。

## 1. 强制原则
- 本系统为多租户平台，业务数据必须通过 `school_id` 进行学校级隔离。
- 任何“未经授权跨校查询/修改数据”均为验收一票否决项。

## 2. 统一规则（所有需求默认叠加）
1. **school_id 必填且不可变**：所有业务数据写入必须携带并固化 `school_id`，写入后不得修改。
2. **查询必须带 school_id 过滤**：列表/详情/检索类查询必须在查询条件中包含 `school_id`（集团汇总聚合场景除外）。
3. **分页强制**：所有列表接口必须分页，且 `limit<=100`。
4. **跨校访问禁止**：学校侧身份不得通过任何方式访问其它学校数据；集团人员也必须在授权范围内。

## 3. 集团汇总与单校视角
- 集团模式允许：
  - `X-View-Scope: all`：全集团汇总（仅授权角色）
  - `X-View-Scope: {school_uuid}`：进入指定学校视角
- 集团人员进入学校视角的 VIEW/CREATE/UPDATE/DELETE 必须产生审计日志。

## 4. 与单条需求文件的关系
每个 `req-Rxx-xxx.md` 必须显式写清楚：
- 该需求的数据范围是 school-scoped（学校级）、group-scoped（集团汇总）、还是两者兼具；
- 在集团视角下是否允许代理执行、如何限制范围、以及审计要求。
