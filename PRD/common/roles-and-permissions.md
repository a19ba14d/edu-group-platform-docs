# 角色与权限（RBAC/ABAC）规范

> 强制来源：`附件/01-三橙智星开发团队技术协议与开发规范.md`（RBAC/ABAC + Casbin 约束）。

## 1. 角色（典型）
- 集团管理员（Group）：全集团汇总视角；可按授权切换到指定学校视角；集团代理必须审计。
- 学校管理员（School）：仅本校数据；管理本校用户、组织结构、人员与业务配置。
- 校区/部门管理员：仅授权组织子树范围。
- 教职工：按岗位与授权处理业务。
- 学生/家长：仅访问本人/授权关系相关数据。

## 2. 权限点与最小粒度
- **必须**：每条验收需求使用最小粒度权限点：`req:Rxx-xxx`。
- **可选**：配套通用权限点 `<resource>:<action>`（例如 `student:update`、`role:read`），用于菜单/操作级权限，但不得替代 `req:Rxx-xxx` 的可追溯性。

## 3. 校验口径（验收级）
1. 身份鉴权：可解析出 org_type/org_id/role/school_id（或等价租户上下文）。
2. RBAC：是否具备 `req:Rxx-xxx`（以及必要的 `<resource>:<action>`）。
3. ABAC：是否满足数据范围（school_id、组织路径、是否本人/授权关系等）。

## 4. 集团/学校双视角约束
- 集团人员允许“全集团汇总”与“进入指定学校视角”；进入学校视角的任何 VIEW/CREATE/UPDATE/DELETE 必须审计。
- 学校人员禁止跨校；不得通过参数/Header 绕过 school_id 隔离。
